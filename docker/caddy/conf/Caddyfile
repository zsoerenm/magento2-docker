# Production Caddyfile - uses Let's Encrypt for automatic HTTPS
# For development with mkcert, see Caddyfile.dev

{
  email {$CADDY_EMAIL}
}

import /etc/caddy/conf.d/*.caddy

{$DOMAIN} {
  encode gzip

  # Let's Encrypt automatic HTTPS
  tls {
    protocols tls1.2 tls1.3
  }

  # Reverse proxy all requests to Varnish
  # Varnish will handle caching and forward to the appropriate backend
  reverse_proxy varnish:80 {
    header_up X-Forwarded-Proto {scheme}
    header_up X-Forwarded-For {remote}
  }
}
